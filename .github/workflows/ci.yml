name: CI Infrastructure

on:
  push:
    paths:
      - "ansible/**"
      - "terraform/**"
      - "la_manu_front/**"
  pull_request:

jobs:
  ci-checks:
    name: Vérifications CI
    runs-on: ubuntu-latest

    steps:
      - name: 🔄 Checkout
        uses: actions/checkout@v3

      - name: 🛠 Installer outils
        run: |
          sudo apt update
          sudo apt install -y ansible terraform npm docker.io
          sudo systemctl start docker

      - name: ✅ Ansible Syntax Check
        run: ansible-playbook ansible/site.yml --syntax-check

      - name: 🔍 Terraform Validation
        run: |
          terraform -chdir=terraform init -input=false
          terraform -chdir=terraform validate

      - name: 🧪 Tests Jest
        run: |
          cd la_manu_front
          npm install
          npm run test --